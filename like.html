<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Editor Master de Vitrine - TikTok Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
    :root { --primary: #fe2c55; --bg-dark: #121212; --bg-card: #1e1e1e; }
    body { font-family: 'Inter', sans-serif; background: #f4f6f8; margin: 0; display: flex; height: 100vh; overflow: hidden; }
    
    /* ESQUERDA: EDITOR */
    .editor-panel { width: 450px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; height: 100%; box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 10; }
    .editor-content { padding: 20px; overflow-y: auto; flex: 1; }
    
    h2 { font-size: 18px; color: #333; margin: 0 0 15px 0; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
    h3 { font-size: 14px; color: #555; margin: 20px 0 10px 0; text-transform: uppercase; letter-spacing: 0.5px; }

    /* Inputs */
    .input-group { margin-bottom: 10px; }
    label { display: block; font-size: 11px; font-weight: 600; color: #666; margin-bottom: 4px; }
    input, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px; box-sizing: border-box; }
    textarea { width: 100%; height: 80px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; font-size: 11px; resize: vertical; box-sizing: border-box; }

    /* Bot√µes */
    .btn { width: 100%; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; margin-bottom: 5px; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: #e02448; }
    .btn-secondary { background: #eee; color: #333; border: 1px solid #ddd; }
    .btn-secondary:hover { background: #e0e0e0; }
    .btn-action { display: flex; gap: 5px; margin-top: 5px; }
    
    /* Lista de Itens */
    .item-list { margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; }
    .item-row { display: flex; align-items: center; justify-content: space-between; background: #fafafa; padding: 8px; border: 1px solid #eee; border-radius: 4px; margin-bottom: 5px; }
    .item-info { font-size: 12px; font-weight: 600; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 200px; }
    .item-actions button { background: none; border: none; cursor: pointer; font-size: 14px; padding: 2px 5px; }
    .btn-edit { color: #2980b9; }
    .btn-del { color: #c0392b; }

    /* DIREITA: PREVIEW */
    .preview-panel { flex: 1; background: #eef2f5; display: flex; justify-content: center; align-items: flex-start; padding: 40px; overflow-y: auto; }
    .phone-frame { width: 375px; background: var(--bg-dark); min-height: 600px; border-radius: 20px; border: 8px solid #333; padding: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    
    /* Estilos do Produto (iguais ao original) */
    .masonry-grid { column-count: 2; column-gap: 10px; }
    .product-card { break-inside: avoid; margin-bottom: 10px; background: var(--bg-card); border-radius: 8px; overflow: hidden; position: relative; border: 1px solid #333; }
    .card-img { width: 100%; display: block; aspect-ratio: 1/1; object-fit: cover; background: #000; }
    .card-info { padding: 8px; }
    .card-title { font-size: 12px; margin-bottom: 4px; color: #fff; line-height: 1.3; height: 32px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; font-family: sans-serif; }
    .card-price { font-weight: 700; color: #fe2c55; font-size: 13px; font-family: sans-serif; }
    .badge-row { display:flex; gap:4px; margin-top:4px; flex-wrap:wrap; }
    .badge-sm { font-size: 9px; padding: 2px 4px; border-radius: 3px; background: rgba(37, 244, 238, 0.15); color: #25f4ee; font-family: sans-serif; }

    /* Status e Mensagens */
    .status-box { padding: 10px; background: #d4edda; color: #155724; border-radius: 4px; font-size: 12px; margin-top: 10px; display: none; text-align: center; }
</style>
</head>
<body>

<div class="editor-panel">
    <div class="editor-content">
        <h2>Editor Master de Vitrine</h2>
        
        <div style="background:#f8f9fa; padding:10px; border:1px solid #ddd; border-radius:6px; margin-bottom:20px;">
            <label>üìÇ Op√ß√£o A: Carregar Arquivo HTML Original</label>
            <input type="file" id="fileInput" accept=".html" style="margin-bottom:5px;">
            <button class="btn btn-secondary" onclick="loadFile()">Carregar Arquivo</button>
            
            <div style="margin: 10px 0; text-align: center; font-size: 11px; color: #888;">OU</div>

            <label>üìù Op√ß√£o B: Colar C√≥digo HTML Aqui</label>
            <textarea id="pasteArea" placeholder="Cole aqui seu c√≥digo HTML antigo..."></textarea>
            <button class="btn btn-secondary" onclick="loadFromPaste()">Ler C√≥digo Colado</button>
        </div>

        <h3>Adicionar / Editar Produto</h3>
        <input type="hidden" id="editIndex" value="-1">
        
        <div class="input-group">
            <label>Nome do Produto</label>
            <input type="text" id="pName">
        </div>
        <div class="input-group">
            <label>Pre√ßo</label>
            <input type="text" id="pPrice">
        </div>
        <div class="input-group">
            <label>Imagem (URL)</label>
            <input type="text" id="pImg">
        </div>
        <div class="input-group">
            <label>Link de Destino</label>
            <input type="text" id="pLink">
        </div>
        <div class="input-group">
            <label>Badge</label>
            <select id="pBadge">
                <option value="">Nenhum</option>
                <option value="Promo√ß√£o">Promo√ß√£o</option>
                <option value="Novidade">Novidade</option>
                <option value="Mais Vendido">Mais Vendido</option>
                <option value="-50% OFF">-50% OFF</option>
            </select>
        </div>

        <button class="btn btn-primary" onclick="addOrUpdateProduct()" id="btnSaveItem">Adicionar Produto</button>
        <button class="btn btn-secondary" onclick="clearForm()" style="margin-top:5px;">Limpar Campos</button>

        <div class="item-list" id="itemList">
            </div>

        <div style="margin-top:auto; padding-top:20px;">
            <h3>Finalizar</h3>
            <button class="btn btn-primary" style="background:#27ae60;" onclick="generateFile()">üíæ Baixar HTML Atualizado</button>
            <div class="status-box" id="statusBox"></div>
        </div>
    </div>
</div>

<div class="preview-panel">
    <div class="phone-frame">
        <h3 style="color:white; margin-top:0;">Vitrine (Preview)</h3>
        <div class="masonry-grid" id="gridPreview">
            </div>
    </div>
</div>

<script>
    // --- ESTADO DA APLICA√á√ÉO ---
    let products = [];
    let originalHTMLContent = ""; // Guarda o HTML do arquivo carregado

    // --- AO INICIAR: Carregar do LocalStorage ---
    window.onload = function() {
        const saved = localStorage.getItem('vitrineProducts');
        const savedHTML = localStorage.getItem('vitrineOriginalHTML');
        
        if (saved) {
            products = JSON.parse(saved);
            renderList();
            renderPreview();
        }
        if (savedHTML) {
            originalHTMLContent = savedHTML;
            showStatus("HTML base carregado da mem√≥ria.");
        }
    };

    // --- FUN√á√ïES DE IMPORTA√á√ÉO ---
    
    // Op√ß√£o A: Arquivo
    function loadFile() {
        const fileInput = document.getElementById('fileInput');
        if (!fileInput.files[0]) return alert("Selecione um arquivo primeiro.");

        const reader = new FileReader();
        reader.onload = function(e) {
            originalHTMLContent = e.target.result;
            localStorage.setItem('vitrineOriginalHTML', originalHTMLContent); // Salva na mem√≥ria
            parseHTML(originalHTMLContent, true); // true = substituir lista
            showStatus("Arquivo carregado com sucesso!");
        };
        reader.readAsText(fileInput.files[0]);
    }

    // Op√ß√£o B: Colar C√≥digo
    function loadFromPaste() {
        const code = document.getElementById('pasteArea').value;
        if (!code.trim()) return alert("Cole algum c√≥digo primeiro.");
        
        parseHTML(code, false); // false = adicionar √† lista existente (ou true se quiser substituir)
        // Se quiser que o c√≥digo colado substitua tudo, mude para true
        if(confirm("Deseja substituir a lista atual pelos produtos do c√≥digo colado? (Clique Cancelar para apenas adicionar)")) {
            products = [];
        }
        parseHTML(code);
        document.getElementById('pasteArea').value = '';
        showStatus("Produtos importados do c√≥digo!");
    }

    // O "C√©rebro" que l√™ o HTML
    function parseHTML(htmlString) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlString, 'text/html');
        
        // Tenta achar cards
        const cards = doc.querySelectorAll('.product-card');
        
        if (cards.length === 0) {
            // Tenta ver se colou apenas o link <a> com o card dentro (comum)
            if(htmlString.includes('product-card')) {
                // Fallback simples se o parser falhar em fragmentos
                // (Para casos complexos, o parser DOM costuma resolver)
            } else {
                alert("Nenhum produto encontrado neste c√≥digo.");
                return;
            }
        }

        cards.forEach(card => {
            // Extra√ß√£o de dados
            const imgEl = card.querySelector('.card-img');
            const titleEl = card.querySelector('.card-title');
            const priceEl = card.querySelector('.card-price');
            const badgeEl = card.querySelector('.badge-sm');
            
            // Tenta achar o link pai
            let link = "#";
            if (card.parentElement.tagName === 'A') {
                link = card.parentElement.getAttribute('href');
            } else if (card.tagName === 'A') { // caso o card seja o A
                link = card.getAttribute('href');
            }

            products.push({
                name: titleEl ? titleEl.innerText.trim() : "Produto sem nome",
                price: priceEl ? priceEl.innerText.trim() : "R$ 0,00",
                img: imgEl ? imgEl.src : "",
                link: link,
                badge: badgeEl ? badgeEl.innerText.trim() : ""
            });
        });

        saveAndRender();
    }

    // --- CRUD PRODUTOS ---

    function addOrUpdateProduct() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const img = document.getElementById('pImg').value;
        const link = document.getElementById('pLink').value;
        const badge = document.getElementById('pBadge').value;
        const index = document.getElementById('editIndex').value;

        if (!name) return alert("Preencha o nome do produto.");

        const product = { name, price, img, link, badge };

        if (index > -1) {
            products[index] = product; // Atualizar
        } else {
            products.push(product); // Adicionar
        }

        clearForm();
        saveAndRender();
    }

    function editProduct(index) {
        const p = products[index];
        document.getElementById('pName').value = p.name;
        document.getElementById('pPrice').value = p.price;
        document.getElementById('pImg').value = p.img;
        document.getElementById('pLink').value = p.link;
        
        // Ajuste badge select
        const sel = document.getElementById('pBadge');
        sel.value = "";
        for (let i=0; i<sel.options.length; i++) {
            if(sel.options[i].text === p.badge || sel.options[i].value === p.badge) sel.selectedIndex = i;
        }

        document.getElementById('editIndex').value = index;
        document.getElementById('btnSaveItem').innerText = "Salvar Altera√ß√£o";
        document.getElementById('btnSaveItem').style.background = "#2980b9";
    }

    function removeProduct(index) {
        if(confirm("Remover este item?")) {
            products.splice(index, 1);
            saveAndRender();
        }
    }

    function clearForm() {
        document.getElementById('pName').value = '';
        document.getElementById('pPrice').value = '';
        document.getElementById('pImg').value = '';
        document.getElementById('pLink').value = '';
        document.getElementById('pBadge').value = '';
        document.getElementById('editIndex').value = '-1';
        document.getElementById('btnSaveItem').innerText = "Adicionar Produto";
        document.getElementById('btnSaveItem').style.background = "#fe2c55";
    }

    // --- RENDERIZA√á√ÉO E SALVAMENTO ---

    function saveAndRender() {
        localStorage.setItem('vitrineProducts', JSON.stringify(products)); // Salva no navegador
        renderList();
        renderPreview();
    }

    function renderList() {
        const list = document.getElementById('itemList');
        list.innerHTML = products.map((p, i) => `
            <div class="item-row">
                <div class="item-info"><b>${i+1}.</b> ${p.name}</div>
                <div class="item-actions">
                    <button class="btn-edit" onclick="editProduct(${i})">‚úé</button>
                    <button class="btn-del" onclick="removeProduct(${i})">√ó</button>
                </div>
            </div>
        `).join('');
    }

    function renderPreview() {
        const grid = document.getElementById('gridPreview');
        if (products.length === 0) {
            grid.innerHTML = '<div style="color:#888; text-align:center; padding:20px; grid-column:1/-1;">Nenhum produto na vitrine</div>';
            return;
        }

        grid.innerHTML = products.map(p => {
            const badgeHtml = p.badge ? `<div class="badge-row"><span class="badge-sm">${p.badge}</span></div>` : '';
            return `
            <div class="product-card">
                <img src="${p.img || 'https://placehold.co/150'}" class="card-img">
                <div class="card-info">
                    <div class="card-title">${p.name}</div>
                    <div class="card-price">${p.price}</div>
                    ${badgeHtml}
                </div>
            </div>`;
        }).join('');
    }

    // --- GERAR ARQUIVO FINAL ---

    function generateFile() {
        if (!originalHTMLContent) {
            alert("‚ö†Ô∏è Voc√™ precisa carregar o Arquivo Original (Op√ß√£o A) primeiro, para que eu saiba onde colocar os produtos!");
            return;
        }

        const parser = new DOMParser();
        const doc = parser.parseFromString(originalHTMLContent, 'text/html');
        const vitrine = doc.querySelector('.masonry-grid');

        if (!vitrine) return alert("Erro: O arquivo original n√£o tem a classe .masonry-grid");

        // Gera o HTML final dos produtos
        const newContent = products.map(p => {
            const badgeHtml = p.badge ? `<div class="badge-row"><span class="badge-sm">${p.badge}</span></div>` : '';
            return `
<a href="${p.link || '#'}" style="text-decoration:none;">
    <div class="product-card">
        <img src="${p.img}" class="card-img" alt="${p.name}">
        <div class="card-info">
            <div class="card-title">${p.name}</div>
            <div class="card-price">${p.price}</div>
            ${badgeHtml}
        </div>
    </div>
</a>`;
        }).join('\n');

        // Substitui no documento
        vitrine.innerHTML = newContent;

        // Download
        const blob = new Blob([doc.documentElement.outerHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "vitrine-atualizada.html";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        showStatus("Arquivo baixado com sucesso!");
    }

    function showStatus(msg) {
        const el = document.getElementById('statusBox');
        el.innerText = msg;
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 4000);
    }

</script>

</body>
</html>