<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Alves 7 - Admin (Conectado)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* CSS PADR√ÉO DO PAINEL */
        :root { --primary-pink: #fe2c55; --primary-cyan: #25f4ee; --primary-amber: #f4a225; --dark-bg: #121212; --card-bg: #1e1e1e; --sidebar-bg: #181818; --text-muted: #8a8b91; --border-color: #333; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--dark-bg); color: white; font-family: 'Inter', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 260px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border-color); padding: 30px 20px; display: flex; flex-direction: column; justify-content: space-between; }
        .brand { font-size: 24px; font-weight: 900; color: white; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .brand .role-badge { font-size: 12px; background: var(--primary-pink); padding: 2px 8px; border-radius: 12px; font-weight: 700; text-transform: uppercase; }
        .menu-label { font-size: 12px; color: var(--text-muted); font-weight: 700; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .menu-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; text-decoration: none; color: white; border-radius: 8px; font-weight: 600; transition: all 0.3s ease; margin-bottom: 8px; }
        .menu-item.active { background-color: rgba(37, 244, 238, 0.1); color: var(--primary-cyan); }
        .menu-item:hover:not(.active) { background-color: #2a2a2a; cursor: pointer; }
        .menu-icon { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; scroll-behavior: smooth; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn-view-store { display: flex; align-items: center; gap: 8px; background: var(--primary-cyan); color: var(--dark-bg); text-decoration: none; padding: 10px 20px; border-radius: 30px; font-weight: 700; box-shadow: 0 4px 15px rgba(37, 244, 238, 0.3); transition: 0.3s; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 16px; border: 1px solid var(--border-color); display: flex; align-items: center; gap: 15px; }
        .stat-icon { width: 50px; height: 50px; background: rgba(37, 244, 238, 0.1); color: var(--primary-cyan); border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .stat-info h3 { font-size: 32px; font-weight: 900; }
        .content-grid { display: grid; grid-template-columns: 1.2fr 2fr; gap: 30px; }
        .card { background: var(--card-bg); padding: 25px; border-radius: 16px; border: 1px solid var(--border-color); box-shadow: 0 4px 20px rgba(0,0,0,0.2); height: fit-content;}
        .card-header { font-size: 18px; font-weight: 700; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;}
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-group.full-width { grid-column: span 2; }
        label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 12px; font-weight: 600; text-transform: uppercase; }
        input { width: 100%; padding: 14px; background-color: var(--dark-bg); border: 2px solid var(--border-color); border-radius: 10px; color: white; font-size: 14px; transition: 0.3s; font-family: 'Inter', sans-serif; }
        input:focus { border-color: var(--primary-cyan); outline: none; }
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-add { flex: 1; padding: 14px; background-color: var(--primary-pink); border: none; border-radius: 10px; color: white; font-weight: 800; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-add:hover { background-color: #d92346; }
        .btn-add.editing { background-color: var(--primary-amber); }
        .btn-cancel { padding: 14px 20px; background-color: #333; border: none; border-radius: 10px; color: white; font-weight: 700; cursor: pointer; font-size: 14px; transition: 0.3s; display: none; }
        .product-list-container { max-height: 600px; overflow-y: auto; padding-right: 5px; }
        .product-item { display: flex; align-items: center; justify-content: space-between; background: var(--dark-bg); padding: 12px; border-radius: 12px; margin-bottom: 12px; border: 1px solid var(--border-color); }
        .product-info-flex { display: flex; align-items: center; gap: 15px; }
        .product-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 1px solid #333; }
        .product-details h4 { font-size: 14px; font-weight: 700; margin-bottom: 4px; color: white; }
        .product-details p { font-size: 13px; color: var(--primary-cyan); font-weight: 600; }
        .btn-icon { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border: none; border-radius: 8px; cursor: pointer; margin-left: 5px; }
        .btn-delete-icon { background: rgba(254, 44, 85, 0.1); color: var(--primary-pink); }
        .btn-edit-icon { background: rgba(244, 162, 37, 0.1); color: var(--primary-amber); }
        
        /* TELA DE LOGIN */
        #loginScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #0d0d0d; z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .login-box {
            background: #1e1e1e; padding: 40px; border-radius: 16px;
            border: 1px solid #333; width: 350px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .login-title { font-size: 24px; font-weight: 800; margin-bottom: 20px; color: white; }
        .login-input { margin-bottom: 15px; width: 100%; }
        .login-btn { width: 100%; padding: 12px; background: var(--primary-pink); border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .login-btn:hover { background: #d92346; }
        .error-msg { color: #ff3e3e; font-size: 12px; margin-top: 10px; display: none; }
        
        #loadingOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; display:flex; justify-content:center; align-items:center; color:white; font-weight:bold; }

        @media (max-width: 900px) { body { flex-direction: column; height: auto; overflow: auto; } .sidebar { width: 100%; padding: 20px; flex-direction: row; align-items: center; flex-wrap: wrap; } .content-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    
    <div id="loginScreen">
        <div class="login-box">
            <div class="brand" style="justify-content: center; margin-bottom: 20px;">
                Alves 7 <span class="role-badge">Admin</span>
            </div>
            <div class="login-title">Acesso Restrito</div>
            <input type="text" id="username" class="login-input" placeholder="Usu√°rio">
            <input type="password" id="password" class="login-input" placeholder="Senha">
            <button class="login-btn" onclick="checkLogin()">Entrar no Painel</button>
            <p id="errorMsg" class="error-msg">Usu√°rio ou senha incorretos!</p>
        </div>
    </div>

    <div id="loadingOverlay" style="display:none;">Conectando ao Banco de Dados...</div>

    <aside class="sidebar">
        <div>
            <div class="brand">Alves 7 <span class="role-badge">Admin</span></div>
            <div class="menu-label">Gerenciamento</div>
            <a href="#" class="menu-item active">Produtos (Nuvem)</a>
            <a href="criador.html" target="_blank" class="menu-item">Criador de P√°ginas</a>
        </div>
        <div class="sidebar-footer">
            <a onclick="logout()" class="menu-item" style="color: #ff3e3e; justify-content: center; border: 1px solid #333;">
                Sair do Painel
            </a>
        </div>
    </aside>

    <main class="main-content">
        <div class="header">
            <div><h2>Ol√°, Alves! üëã</h2><p style="color: var(--text-muted);">Tudo que voc√™ editar aqui atualiza para todos.</p></div>
            <div class="header-actions">
                <a href="index.html" class="btn-view-store" target="_blank">Ver Loja Online</a>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-info"><h3 id="totalProductsCount">...</h3><p>Produtos Ativos</p></div>
            </div>
        </div>

        <div class="content-grid">
            <div class="card" id="formCard">
                <div class="card-header" id="formHeader">‚ú® Adicionar Novo Produto</div>
                <div class="form-grid">
                    <div class="form-group full-width"><label>Nome</label><input type="text" id="pTitle" placeholder="Ex: iPhone 15"></div>
                    <div class="form-group"><label>Pre√ßo</label><input type="text" id="pPrice" placeholder="R$ 0,00"></div>
                    <div class="form-group"><label>Pre√ßo Antigo</label><input type="text" id="pOldPrice" placeholder="R$ 0,00"></div>
                    <div class="form-group full-width"><label>Imagem (URL)</label><input type="text" id="pImg" placeholder="images/foto.jpg"></div>
                    <div class="form-group full-width"><label>Link (HTML)</label><input type="text" id="pLink" placeholder="produto.html"></div>
                </div>
                <div class="btn-group">
                    <button class="btn-cancel" id="btnCancel">Cancelar</button>
                    <button class="btn-add" id="btnSave">+ Publicar na Nuvem</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">üì¶ Invent√°rio (Nuvem)</div>
                <div class="product-list-container" id="productList"></div>
            </div>
        </div>
    </main>

    <script>
        const USER_DATA = { u: "Alves7", p: "911686" };
        const loginScreen = document.getElementById('loginScreen');
        const loadingOverlay = document.getElementById('loadingOverlay');

        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            loginScreen.style.display = 'none';
            loadingOverlay.style.display = 'flex';
        }

        function checkLogin() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const err = document.getElementById('errorMsg');

            if (u === USER_DATA.u && p === USER_DATA.p) {
                sessionStorage.setItem('isLoggedIn', 'true');
                location.reload(); 
            } else {
                err.style.display = 'block';
            }
        }

        function logout() {
            sessionStorage.removeItem('isLoggedIn');
            location.reload();
        }

        document.getElementById('password').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') checkLogin();
        });
    </script>

    <script type="module">
        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            
            // IMPORTANDO AS BIBLIOTECAS DO FIREBASE VIA CDN (WEB)
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
            import { getDatabase, ref, set, onValue, push, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

            // --- SUAS CONFIGURA√á√ïES ---
            const firebaseConfig = {
                apiKey: "AIzaSyCvXcgBkLNFBX8G0c6bUYxGd_6St_l7H4s",
                authDomain: "lojatiktok-9db54.firebaseapp.com",
                databaseURL: "https://lojatiktok-9db54-default-rtdb.firebaseio.com",
                projectId: "lojatiktok-9db54",
                storageBucket: "lojatiktok-9db54.firebasestorage.app",
                messagingSenderId: "569412749516",
                appId: "1:569412749516:web:e7ca0fc5c6dbe6b3985a69",
                measurementId: "G-7ZQ2NFR3QV"
            };

            // INICIALIZA√á√ÉO
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app); // Seu analytics ativado
            const db = getDatabase(app);
            
            let products = [];
            let editId = null;

            const loading = document.getElementById('loadingOverlay');
            const listDiv = document.getElementById('productList');
            const countSpan = document.getElementById('totalProductsCount');
            const btnSave = document.getElementById('btnSave');
            const btnCancel = document.getElementById('btnCancel');
            const formHeader = document.getElementById('formHeader');

            // LER DADOS DO BANCO
            const productsRef = ref(db, 'products');
            onValue(productsRef, (snapshot) => {
                loading.style.display = 'none';
                const data = snapshot.val();
                
                products = [];
                if(data) {
                    Object.keys(data).forEach(key => {
                        products.push({ id: key, ...data[key] });
                    });
                }
                products.reverse();
                renderList();
            });

            function renderList() {
                listDiv.innerHTML = '';
                countSpan.innerText = products.length;

                if (products.length === 0) {
                    listDiv.innerHTML = '<div class="empty-state"><p>Nenhum produto na nuvem.</p></div>';
                    return;
                }

                products.forEach((p) => {
                    const item = document.createElement('div');
                    item.className = 'product-item';
                    item.innerHTML = `
                        <div class="product-info-flex">
                            <img src="${p.img}" class="product-thumb" onerror="this.src='https://placehold.co/60x60?text=Err'">
                            <div class="product-details"><h4>${p.title}</h4><p>${p.price}</p></div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn-icon btn-edit-icon" id="edit-${p.id}">‚úèÔ∏è</button>
                            <button class="btn-icon btn-delete-icon" id="del-${p.id}">üóëÔ∏è</button>
                        </div>
                    `;
                    listDiv.appendChild(item);
                    
                    document.getElementById(`edit-${p.id}`).onclick = () => startEdit(p);
                    document.getElementById(`del-${p.id}`).onclick = () => deleteProduct(p.id);
                });
            }

            btnSave.onclick = () => {
                const title = document.getElementById('pTitle').value;
                const price = document.getElementById('pPrice').value;
                const oldPrice = document.getElementById('pOldPrice').value;
                const img = document.getElementById('pImg').value;
                const link = document.getElementById('pLink').value;

                if(!title || !price || !img) { alert('Preencha os dados!'); return; }

                const productData = { title, price, oldPrice, img, link };

                if(editId) {
                    update(ref(db, 'products/' + editId), productData)
                        .then(() => { alert('Produto atualizado!'); cancelEdit(); })
                        .catch((e) => alert('Erro: ' + e.message));
                } else {
                    push(ref(db, 'products'), productData)
                        .then(() => { alert('Produto criado na nuvem!'); cancelEdit(); })
                        .catch((e) => alert('Erro: ' + e.message));
                }
            };

            window.startEdit = (p) => {
                editId = p.id;
                document.getElementById('pTitle').value = p.title;
                document.getElementById('pPrice').value = p.price;
                document.getElementById('pOldPrice').value = p.oldPrice;
                document.getElementById('pImg').value = p.img;
                document.getElementById('pLink').value = p.link;

                btnSave.innerText = 'Salvar Altera√ß√£o';
                btnSave.classList.add('editing');
                formHeader.innerText = '‚úèÔ∏è Editando';
                btnCancel.style.display = 'block';
                document.querySelector('.main-content').scrollTo(0,0);
            };

            window.deleteProduct = (id) => {
                if(confirm('Tem certeza? Isso apagar√° para todos os clientes.')) {
                    remove(ref(db, 'products/' + id));
                }
            };

            window.cancelEdit = () => {
                editId = null;
                document.querySelectorAll('input').forEach(i => i.value = '');
                btnSave.innerText = '+ Publicar na Nuvem';
                btnSave.classList.remove('editing');
                formHeader.innerText = '‚ú® Adicionar Novo Produto';
                btnCancel.style.display = 'none';
            };
            btnCancel.onclick = window.cancelEdit;
        }
    </script>
</body>
</html>